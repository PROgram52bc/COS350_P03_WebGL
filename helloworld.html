<html>
	<style>
		/* Adding very basic styling to page so the canvas can be seen */
		body {
			background-color: rgb(224, 224, 224);
		}
		canvas {
			background-color: rgb(255, 255, 255);
			border: 1px solid rgb(192, 192, 192);
		}
	</style>

	<body>
		<canvas id="c"></canvas>
	</body>

	<script type="notjs" id="2d-vertex-shader">
		in vec4 position;
		void main() {
			gl_Position = position;
		}
	</script>

	<script type="notjs" id="2d-fragment-shader">
		precision highp float;
		in vec4 position;
		out vec4 color;
		void main() {
			color = vec4(1,0,0.5,1);
		}
	</script>

	<script>
		// Place Javascript code here
		function addVersionToShaderSource(source) {
			return "#version 300 es\n" + source;
		}
		function createShader(gl, type, source) {
			source = addVersionToShaderSource(source);
			var shader = gl.createShader(type); // type is 'gl.VERTEX_SHADER' or 'gl.FRAGMENT_SHADER'
			gl.shaderSource(shader, source); // specify the shader source
			gl.compileShader(shader); // compile the shader
			var success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);
			if (success) {
				return shader;
			}
			console.log("Failed to compile shader");
			console.log(gl.getShaderInfoLog(shader));
			gl.deleteShader(shader);
		}
		function createProgram(gl, vertexShader, fragmentShader) {
			var program = gl.createProgram();
			gl.attachShader(program, vertexShader);
			gl.attachShader(program, fragmentShader);
			gl.linkProgram(program);
			var success = gl.getProgramParameter(program, gl.LINK_STATUS);
			if (success) {
				return program;
			}
			console.log(gl.getProgramInfoLog(program)); // eslint-disable-line
			gl.deleteProgram(program);
			return undefined;
		}
		function main() {
			console.log("Hello");
			var canvas = document.querySelector("#c");
			var gl = canvas.getContext("webgl2");
			var vertexShaderSource = document.getElementById("2d-vertex-shader")
				.textContent;
			var fragmentShaderSource = document.getElementById(
				"2d-fragment-shader"
			).textContent;
			if (!gl) {
				return;
			}
			var vertexShader = createShader(
				gl,
				gl.VERTEX_SHADER,
				vertexShaderSource
			);
			var fragmentShader = createShader(
				gl,
				gl.FRAGMENT_SHADER,
				fragmentShaderSource
			);
			var program = createProgram(gl, vertexShader, fragmentShader);
			// look up where the vertex data needs to go.
			var positionAttributeLocation = gl.getAttribLocation(
				program,
				"position"
			);
			// Create a buffer and put three 2d clip space points in it
			var positionBuffer = gl.createBuffer();
			// Bind it to ARRAY_BUFFER (think of it as ARRAY_BUFFER = positionBuffer)
			gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);

			// create the buffer data
			var positions = [0, 0, 0, 0.5, 0.7, 0];
			gl.bufferData(
				gl.ARRAY_BUFFER,
				new Float32Array(positions),
				gl.STATIC_DRAW
			);
			// Create a vertex array object (attribute state)
			var vao = gl.createVertexArray();

			// and make it the one we're currently working with
			gl.bindVertexArray(vao);

			// Turn on the attribute
			gl.enableVertexAttribArray(positionAttributeLocation);

			// Tell the attribute how to get data out of positionBuffer (ARRAY_BUFFER)
			var size = 2; // 2 components per iteration
			var type = gl.FLOAT; // the data is 32bit floats
			var normalize = false; // don't normalize the data
			var stride = 0; // 0 = move forward size * sizeof(type) each iteration to get the next position
			var offset = 0; // start at the beginning of the buffer
			gl.vertexAttribPointer(
				positionAttributeLocation,
				size,
				type,
				normalize,
				stride,
				offset
			);

			// webglUtils.resizeCanvasToDisplaySize(gl.canvas);

			// Tell WebGL how to convert from clip space to pixels
			gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);

			// Clear the canvas
			gl.clearColor(0, 0, 0, 0);
			gl.clear(gl.COLOR_BUFFER_BIT);

			// Tell it to use our program (pair of shaders)
			gl.useProgram(program);

			// Bind the attribute/buffer set we want.
			gl.bindVertexArray(vao);

			// draw
			var primitiveType = gl.TRIANGLES;
			var offset = 0;
			var count = 3;
			gl.drawArrays(primitiveType, offset, count);
		}
		main();
	</script>
</html>
